<?php
// $Id$

/**
 * @file
 * Task tracking
 */

define('TASK_TYPE_ACTIVE', 1);
define('TASK_TYPE_BLOCKED', 2);
define('TASK_TYPE_RESOLVED', 3);
define('TASK_TYPE_CLOSED', 4);

define('TASK_ACTIVE', 1);
define('TASK_WORKING_ON', 2);
define('TASK_BLOCKED', 3);
define('TASK_FEEDBACK', 4);
define('TASK_RESOLVED', 5);
define('TASK_REJECTED', 5);

/**
 * Implements hook_init().
 */
function task_init() {
  drupal_add_css(drupal_get_path('module', 'task') . '/task.css');
}

function task_state_type($type, $state = NULL) {
  static $state_types = array(
    TASK_TYPE_ACTIVE => array(
      TASK_ACTIVE,
      TASK_WORKING_ON,
    ),
    TASK_TYPE_BLOCKED => array(
      TASK_BLOCKED,
      TASK_FEEDBACK,
    ),
    TASK_TYPE_RESOLVED => array(
      TASK_RESOLVED,
    ),
    TASK_TYPE_CLOSED => array(
      TASK_RESOLVED,
      TASK_REJECTED,
    ),
  );
  if ($state) {
    return in_array($state, $state_types[$type]);
  }
  return $state_types[$type];
}

function task_preprocess_node(&$variables) {
  $variables['theme_hook_suggestions'][] = 'node__' . $variables['view_mode'];
}

function task_entity_info_alter(&$entity_info) {
  $entity_info['node']['view modes']['taskcard'] = array(
    'label' => t('Task card'),
  );
}

function task_field_ui_view_modes_tabs() {
  $modes = array(
    'task' => array(
      'title' => t('Task'),
      'view modes' => array('taskcard'),
    ),
  );
  return $modes;
}

/**
 * Implements hook_theme().
 */
function task_theme() {
  return array(
    'node__taskcard' => array(
      'render element' => 'elements',
      'template' => 'node--taskcard',
    ),
  );
}